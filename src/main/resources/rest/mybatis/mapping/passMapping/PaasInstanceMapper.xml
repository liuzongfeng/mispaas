<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="rest.mybatis.dao.passDao.PaasInstanceMapper" >
  <resultMap id="BaseResultMap" type="rest.mybatis.model.passModel.PaasInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    <id column="INSTANCE_ID" property="instanceId" jdbcType="VARCHAR" />
    <result column="TEMPLATE_ID" property="templateId" jdbcType="INTEGER" />
    <result column="INSTANCE_NAME" property="instanceName" jdbcType="VARCHAR" />
    <result column="INSTANCE_STATUS" property="instanceStatus" jdbcType="INTEGER" />
    <result column="ACCESS_KEY" property="accessKey" jdbcType="VARCHAR" />
    <result column="PUB_DNS" property="pubDns" jdbcType="VARCHAR" />
    <result column="URL_PREFIX" property="urlPrefix" jdbcType="VARCHAR" />
    <result column="ORDER_ID" property="orderId" jdbcType="INTEGER" />
    <result column="VERSION" property="version" jdbcType="VARCHAR" />
   <association property="paasTemplate" column="TEMPLATE_ID"
		javaType="rest.mybatis.model.passModel.PaasTemplate" select="selectTemplateBytemplateId">
	</association>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    INSTANCE_ID, TEMPLATE_ID, INSTANCE_NAME, INSTANCE_STATUS, ACCESS_KEY, PUB_DNS, URL_PREFIX, 
    ORDER_ID,VERSION
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from PAAS_INSTANCE
    where INSTANCE_ID = #{instanceId,jdbcType=VARCHAR}
  </select>
  <!-- 查询实例状态-->
  <select id="obtainInstanceStatus" resultType="java.lang.String" >
    
    select 
    INSTANCE_STATUS
    from PAAS_INSTANCE GROUP BY INSTANCE_STATUS
    
  </select>
  <!-- 查询所有实例 -->
  <select id="obtainInstanceList" resultMap="BaseResultMap" >
    
    select 
    <include refid="Base_Column_List" />
    from PAAS_INSTANCE
    <where>
    	<if test="instanceName != null">
    	 	AND INSTANCE_NAME LIKE CONCAT(CONCAT('%',#{instanceName}),'%')
    	</if>
    	<if test="instanceStatus != null">
    		AND INSTANCE_STATUS = #{instanceStatus}
    	</if>
    </where> 
     ORDER BY INSTANCE_ID DESC
  </select>
  
  <!-- 根据模板id查询实例 -->
  <select id="selectInstanceByTemplateId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from PAAS_INSTANCE
    where TEMPLATE_ID = #{templateId,jdbcType=VARCHAR}
  </select>
  <!-- 通过订单ID查实例 -->
   <select id="selectByorderId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from PAAS_INSTANCE
    where ORDER_ID = #{orderId,jdbcType=INTEGER}
  </select>
   <!-- 子查询模块列表 -->
  <select id="selectTemplateBytemplateId" parameterType="java.lang.Integer" resultMap="rest.mybatis.dao.passDao.PaasTemplateMapper.ResultMapWithBLOBs">
  	  select  ID, TEMPLATE_ID, VERSION, TEMPLATE_TYPE, TEMPLATE_CATEGORY, USER_MODE, PRICE, IS_PUB
  	   from PAAS_TEMPLATE
  	   where ID=#{TEMPLATE_ID,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    delete from PAAS_INSTANCE
    where INSTANCE_ID = #{instanceId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="rest.mybatis.model.passModel.PaasInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    insert into PAAS_INSTANCE (INSTANCE_ID, TEMPLATE_ID, INSTANCE_NAME, 
      INSTANCE_STATUS, ACCESS_KEY, PUB_DNS, 
      URL_PREFIX, ORDER_ID)
    values (#{instanceId,jdbcType=VARCHAR}, #{templateId,jdbcType=INTEGER}, #{instanceName,jdbcType=VARCHAR}, 
      #{instanceStatus,jdbcType=INTEGER}, #{accessKey,jdbcType=VARCHAR}, #{pubDns,jdbcType=VARCHAR}, 
      #{urlPrefix,jdbcType=VARCHAR}, #{orderId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="rest.mybatis.model.passModel.PaasInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    insert into PAAS_INSTANCE
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="instanceId != null" >
        INSTANCE_ID,
      </if>
      <if test="templateId != null" >
        TEMPLATE_ID,
      </if>
      <if test="instanceName != null" >
        INSTANCE_NAME,
      </if>
      <if test="instanceStatus != null" >
        INSTANCE_STATUS,
      </if>
      <if test="accessKey != null" >
        ACCESS_KEY,
      </if>
      <if test="pubDns != null" >
        PUB_DNS,
      </if>
      <if test="urlPrefix != null" >
        URL_PREFIX,
      </if>
      <if test="orderId != null" >
        ORDER_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="instanceId != null" >
        #{instanceId,jdbcType=VARCHAR},
      </if>
      <if test="templateId != null" >
        #{templateId,jdbcType=INTEGER},
      </if>
      <if test="instanceName != null" >
        #{instanceName,jdbcType=VARCHAR},
      </if>
      <if test="instanceStatus != null" >
        #{instanceStatus,jdbcType=INTEGER},
      </if>
      <if test="accessKey != null" >
        #{accessKey,jdbcType=VARCHAR},
      </if>
      <if test="pubDns != null" >
        #{pubDns,jdbcType=VARCHAR},
      </if>
      <if test="urlPrefix != null" >
        #{urlPrefix,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null" >
        #{orderId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="rest.mybatis.model.passModel.PaasInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    update PAAS_INSTANCE
    <set >
      <if test="templateId != null" >
        TEMPLATE_ID = #{templateId,jdbcType=INTEGER},
      </if>
      <if test="instanceName != null" >
        INSTANCE_NAME = #{instanceName,jdbcType=VARCHAR},
      </if>
      <if test="instanceStatus != null" >
        INSTANCE_STATUS = #{instanceStatus,jdbcType=INTEGER},
      </if>
      <if test="accessKey != null" >
        ACCESS_KEY = #{accessKey,jdbcType=VARCHAR},
      </if>
      <if test="pubDns != null" >
        PUB_DNS = #{pubDns,jdbcType=VARCHAR},
      </if>
      <if test="urlPrefix != null" >
        URL_PREFIX = #{urlPrefix,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null" >
        ORDER_ID = #{orderId,jdbcType=INTEGER},
      </if>
    </set>
    where INSTANCE_ID = #{instanceId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="rest.mybatis.model.passModel.PaasInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 08 16:50:01 CST 2017.
    -->
    update PAAS_INSTANCE
    set TEMPLATE_ID = #{templateId,jdbcType=INTEGER},
      INSTANCE_NAME = #{instanceName,jdbcType=VARCHAR},
      INSTANCE_STATUS = #{instanceStatus,jdbcType=INTEGER},
      ACCESS_KEY = #{accessKey,jdbcType=VARCHAR},
      PUB_DNS = #{pubDns,jdbcType=VARCHAR},
      URL_PREFIX = #{urlPrefix,jdbcType=VARCHAR},
      ORDER_ID = #{orderId,jdbcType=INTEGER}
    where INSTANCE_ID = #{instanceId,jdbcType=VARCHAR}
  </update>
  
  <insert id="createInstance" parameterType="rest.mybatis.model.passModel.PaasInstance">
  	<selectKey keyProperty="instanceId" resultType="String" order="BEFORE">
        SELECT UUID()
    </selectKey>
  	insert into PAAS_INSTANCE(INSTANCE_ID,TEMPLATE_ID,INSTANCE_NAME,INSTANCE_STATUS,ORDER_ID)
  	values(#{instanceId},#{templateId},#{instanceName},#{instanceStatus},#{orderId})
  </insert>
  
  <select id="isexistInstance" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  	select count(INSTANCE_ID) from PAAS_INSTANCE where ORDER_ID=#{orderid}
  </select>
  
  <delete id="deleteAllinstanceByorderid" parameterType="java.lang.Integer">
  	delete from PAAS_INSTANCE where ORDER_ID=#{orderid}
  </delete>
  
  <select id="selecttheInstanceByTemplateId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
  	select
  	<include refid="Base_Column_List" />
    from PAAS_INSTANCE
    where TEMPLATE_ID=#{templateId}
  </select>
</mapper>